/*!
 * smart-complete - 为input和textarea提供提示补全功能的AngularJS指令
 * @version 2.0.2
 * @link https://github.com/zskymn/smart-complete#readme
 */
!function(e,t){"function"==typeof define&&define.amd?define(["jquery","angular"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery"),require("angular")):t(e.jQuery,e.angular)}(this,function(e,t){t.module("smart-complete",[]),t.module("smart-complete").service("$scUtil",["$timeout","$q",function(e,t){function n(t,n){var o=null;return 0===n||n||(n=300),function(){var i=this,r=arguments;return e.cancel(o),o=e(function(){return t.apply(i,r)},n)}}function o(){return t.when([])}var i=this;i.debounce=n,i.noopSearchFunc=o}]),t.module("smart-complete").directive("smartComplete",["$parse","$scUtil","$timeout",function(n,o,i){return{restrict:"A",link:function(r,s,c){function u(){if(m=s[0].tagName.toLowerCase(),g=n(c.smartComplete),b=n(c.scSep),k=n(c.scWidth),w=n(c.scHeight),y=n(c.scItemClickCb),C=n(c.scEnterCb),x="current-selected","input"!==m&&"textarea"!==m)throw"tagName must be input or textarea";j=e('<ul class="smart-complete"></ul>'),s.after(j),l(),a()}function l(){s.css("font-size",s.css("font-size")),"textarea"===m&&s.css({overflow:"auto",overflowX:"auto",overflowY:"auto",wordBreak:"break-all"}),j.hide()}function a(){s.off("click.sc").on("click.sc",h).off("keyup.sc").on("keyup.sc",o.debounce(function(e){var t=e.which;13!==t&&38!==t&&40!==t&&9!==t&&h()})).off("keydown.sc").on("keydown.sc",function(e){var n,o=e.which;if(13===o)return j.is(":visible")&&(e.preventDefault(),j.hide()),void i(function(){(C(r)||t.noop)(s.val())});if(9===o)return void(j.is(":visible")&&j.hide());if(38===o)n=!0;else{if(40!==o)return;n=!1}e.preventDefault(),v(n)}),j.off("mouseenter.sc").on("mouseenter.sc","li",function(){e(this).addClass(x)}).off("mouseleave.sc").on("mouseleave.sc","li",function(){j.children().removeClass(x)}).off("click.sc").on("click.sc","li",function(){d(e(this).attr("value"));var n=e(this).attr("value");i(function(){(y(r)||t.noop)(n,s.val())}),j.hide()}),e(document).on("click.sc",function(){j.hide()})}function f(){var e=s.caret("pos"),t=b(r);if(!t)return s.val();t+="";var n=s.val();return n.substring(0,e).split(t).pop()+n.substring(e).split(t)[0]}function p(){var e,t,n,o=k(r),i=parseInt(w(r),10)||240,c=b(r),u=s.position(),l=s.outerWidth(),a=s.outerHeight(),f=s.caret("pos"),p=s.caret("position"),h=s.val();return c?(c+="",e=s.caret("position",f-h.substring(0,f).split(c).pop().length)):(e=s.caret("position",0),e.left=0),"100%"===o?(o=s.outerWidth(),t=0):(o=parseInt(o,10)||240,t=o>=l?0:e.left+o>=l?l-o:e.left),"input"===m?n=a:(n=p.top+p.height-s.scrollTop(),p.top>e.top&&(t=0)),{width:o,maxHeight:i,left:u.left+parseInt(s.css("marginLeft"),10)+t,top:u.top+parseInt(s.css("marginTop"),10)+n+2}}function h(){var n=f();(g(r)||o.noopSearchFunc)(n).then(function(n){return e.map(n,function(e){return t.isObject(e)?e:{label:e,value:e}})},function(){return[]}).then(function(t){return 0===t.length?void j.html("").hide():void j.html(e.map(t,function(e){return'<li value="'+e.value+'">'+e.label+"</li>"}).join("")).css(p()).show()})}function v(e){if(!j.is(":hidden")){var t=j.children();if(0!==t.length){var n=t.filter("."+x).first(),o=n;if(n.length)if(e){var i=n.prev();i.length&&(o=i)}else{var r=n.next();r.length&&(o=r)}else o=e?t.last():t.first();t.removeClass(x),o.addClass(x),d(o.attr("value"));var s=o.position().top,c=0,u=j.height()-o.height();return s>u&&j.scrollTop(j.scrollTop()+s-u),c>s?j.scrollTop(j.scrollTop()+s-c):void 0}}}function d(e){var t,n,o,i,c,u,l=b(r);return l?(l+="",n=s.caret("pos"),c=s.val(),t=c.substring(0,n),u=t.split(l),i=u.pop(),u.push(e),c.substring(n)&&(o=c.substring(n).split(l),o.shift(),o.join(l)&&u.push(o.join(l))),s.val(u.join(l)).caret("pos",n+e.length-i.length),void s.focus().trigger("change")):void s.val(e).focus().trigger("change")}var m,g,b,k,w,y,C,j,x;u()}}}])});